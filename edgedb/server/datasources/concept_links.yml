#!INSTANCE ConceptLinks (semantix.lib.datasources.sql.Sql)

cache: memory

params:
    concept:
        type: str
    direction:
        type: str
        default: "direct"

filters:
    - format: dict

source: |
    SELECT
            cm.source_id,
            sc.name AS source,
            cm.target_id,
            tc.name AS target,
            cm.link_type_id,
            lt.name AS link_type,
            cm.mapping
        FROM
            concept_map cm
            INNER JOIN concept sc ON cm.source_id = sc.id
            INNER JOIN concept tc ON cm.target_id = tc.id
            INNER JOIN concept_map_link_type lt ON lt.id = cm.link_type_id
        WHERE
            (%(direction)s = 'direct' AND sc.name = %(concept)s)
            OR (%(direction)s = 'reverse' AND tc.name = %(concept)s)
