##
# Copyright (c) 2013 MagicStack Inc.
# All rights reserved.
#
# See LICENSE for details.
##


%SCHEMA edgedb.server.datasources.schemas.Sql
%NAME Constraints
---
params:
    name:
        type: str

filters:
    - format: dict

source: |
    SELECT
            a.id           AS id,
            a.name         AS name,
            a.title        AS title,
            a.description  AS description,
            a.is_abstract  AS is_abstract,
            a.is_final     AS is_final,
            (SELECT array_agg(name) FROM edgedb.object
             WHERE id = any(a.bases)) AS bases,
            a.expr         AS expr,
            a.subjectexpr  AS subjectexpr,
            a.localfinalexpr AS localfinalexpr,
            a.finalexpr    AS finalexpr,
            a.errmessage   AS errmessage,
            edgedb._resolve_type_dict(a.paramtypes)
                           AS paramtypes,
            edgedb._resolve_type_dict(a.inferredparamtypes)
                           AS inferredparamtypes,
            a.args         AS args,
            subj.name      AS subject
        FROM
            edgedb.constraint a
            LEFT JOIN edgedb.object subj ON (subj.id = a.subject)
        WHERE
            %(name)s::text IS NULL OR a.name LIKE %(name)s::text
...
