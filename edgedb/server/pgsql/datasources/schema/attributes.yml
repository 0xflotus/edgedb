##
# Copyright (c) 2013 MagicStack Inc.
# All rights reserved.
#
# See LICENSE for details.
##


%SCHEMA edgedb.server.datasources.schemas.Sql
%NAME Attributes
---
params:
    name:
        type: str

filters:
    - format: dict

source: |
    SELECT
            a.id                    AS id,
            a.name                  AS name,
            a.title                 AS title,
            a.description           AS description,
            ta.name                 AS type,
            (a.type).collection     AS type_coll
        FROM
            edgedb.attribute a
            INNER JOIN edgedb.atom ta ON (a.type).type = ta.id
        WHERE
            %(name)s::text IS NULL OR a.name LIKE %(name)s::text
...


%SCHEMA edgedb.server.datasources.schemas.Sql
%NAME AttributeValues
---
params:
    name:
        type: str

filters:
    - format: dict

source: |
    SELECT
            a.id           AS id,
            a.name         AS name,
            a.title        AS title,
            a.description  AS description,
            subj.name      AS subject_name,
            attr.name      AS attribute_name,
            a.value        AS value
        FROM
            edgedb.attribute_value a
            INNER JOIN edgedb.object subj ON (subj.id = a.subject)
            INNER JOIN edgedb.object attr ON (attr.id = a.attribute)
        WHERE
            %(name)s::text IS NULL OR a.name LIKE %(name)s::text
...
