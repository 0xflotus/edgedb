##
# Copyright (c) 2016-present MagicStack Inc.
# All rights reserved.
#
# See LICENSE for details.
##


%SCHEMA edgedb.server.datasources.schemas.Sql
%NAME SourceIndexes
---

filters:
    - format: dict

source: |
    SELECT
            i.id            AS id,
            i.name          AS name,
            i.expr          AS expr,

            (SELECT array_agg(name)
             FROM edgedb.NamedClass
             WHERE id = any(i.bases)) AS bases,

            (SELECT name
             FROM edgedb.NamedClass
             WHERE id = i.subject) AS subject_name

        FROM
            edgedb.SourceIndex i
...
