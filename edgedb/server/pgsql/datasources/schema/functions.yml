##
# Copyright (c) 2008-2016 MagicStack Inc.
# All rights reserved.
#
# See LICENSE for details.
##


%SCHEMA edgedb.server.datasources.schemas.Sql
%NAME FunctionList
---
params:

filters:
    - format: dict

source: |
    SELECT
            f.id AS id,
            f.name AS name,
            f.title AS title,
            f.description AS description,
            f.is_abstract AS is_abstract,
            f.is_final AS is_final,
            (SELECT array_agg(o.name ORDER BY pt.i)
             FROM
                UNNEST(f.paramtypes) WITH ORDINALITY pt (value, i)
                INNER JOIN edgedb.NamedClass o
                    ON o.id = pt.value::uuid
            ) AS paramtypes,
            f.paramnames,
            f.varparam,
            f.paramdefaults,
            f.aggregate,
            f.language,
            f.code,
            f.from_function,
            (SELECT name FROM edgedb.NamedClass WHERE id = f.returntype)
                AS returntype
        FROM
            edgedb.function f
        ORDER BY
            f.id
