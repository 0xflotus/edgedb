##
# Copyright (c) 2012 MagicStack Inc.
# All rights reserved.
#
# See LICENSE for details.
##


%SCHEMA edgedb.server.datasources.schemas.Sql
%NAME Actions
---
params:
    name:
        type: str

filters:
    - format: dict

source: |
    SELECT
            a.id           AS id,
            a.name         AS name,
            a.title        AS title,
            a.description  AS description
        FROM
            edgedb.action a
        WHERE
            %(name)s::text IS NULL OR a.name LIKE %(name)s::text
...


%SCHEMA edgedb.server.datasources.schemas.Sql
%NAME Events
---
params:
    name:
        type: str

filters:
    - format: dict

source: |
    SELECT
            e.id           AS id,
            e.name         AS name,
            (SELECT array_agg(name) FROM edgedb.NamedClass
             WHERE id = any(e.bases)) AS bases,
            e.title        AS title,
            e.description  AS description
        FROM
            edgedb.event e
        WHERE
            %(name)s::text IS NULL OR e.name LIKE %(name)s::text
...


%SCHEMA edgedb.server.datasources.schemas.Sql
%NAME Policies
---
params:
    name:
        type: str

filters:
    - format: dict

source: |
    SELECT
            p.id                        AS id,
            p.name                      AS name,
            p.title                     AS title,
            p.description               AS description,
            edgedb._resolve_type_name(p.subject)
                                        AS subject,
            edgedb._resolve_type_name(p.event)
                                        AS event,
            edgedb._resolve_type_name(p.actions)
                                        AS actions
        FROM
            edgedb.policy p
        WHERE
            %(name)s::text IS NULL OR p.name LIKE %(name)s::text
...
