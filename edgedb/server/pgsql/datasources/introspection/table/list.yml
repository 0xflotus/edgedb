##
# Copyright (c) 2008-2010 Sprymix Inc.
# All rights reserved.
#
# See LICENSE for details.
##


%SCHEMA semantix.caos.datasources.schemas.Sql
%NAME TableList
---
params:
    schema_name:
        type: str
        default: "public"
    table_pattern:
        type: str

filters:
    - format: dict

source: |
        SELECT
                c.oid                                 AS oid,
                c.relname                             AS name,
                ns.nspname                            AS schema
            FROM
                pg_class AS c
                INNER JOIN pg_namespace AS ns ON ns.oid = c.relnamespace
            WHERE
                --
                -- Limit the schema scope
                --
                ns.nspname LIKE %(schema_name)s
                --
                -- Only specified tables
                --
                AND c.relname LIKE %(table_pattern)s
                --
                -- And only real tables
                --
                AND c.relkind = 'r'
