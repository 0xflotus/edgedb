##
# Copyright (c) 2008-2010 Sprymix Inc.
# All rights reserved.
#
# See LICENSE for details.
##


%SCHEMA semantix.utils.lang.yaml.schema.Schema
%NAME Semantics
---
type: map
object: semantix.caos.backends.yaml.MetaSet
mapping:
    "module":
        type: str
        required: no

    "backend":
        type: str
        required: no
        default: "data"

    "atoms":
        type: map
        default: {}
        mapping:
            =: # name of an atom
                type: map
                object: semantix.caos.backends.yaml.Atom
                required: yes
                mapping:
                    "title": &TEXT_WITH_GRAM_CATEGORIES
                        type: choice
                        object: semantix.caos.backends.yaml.WordCombination
                        choice:
                            - type: str
                            - type: map
                              mapping:
                                =:
                                    type: str

                    "description":
                        type: str

                    "extends":
                        type: choice
                        required: yes
                        choice:
                            - type: str
                            - type: seq
                              sequence:
                                - type: str

                    "abstract":
                        type: bool
                        default: null

                    "default": &DEFAULT
                        type: choice
                        choice:
                            - &DEFAULT_ITEM
                              type: choice
                              choice:
                                - type: scalar
                                  object: semantix.caos.backends.yaml.LiteralDefaultSpec
                                  required: true

                                - type: map
                                  object: semantix.caos.backends.yaml.QueryDefaultSpec
                                  max-length: 1
                                  min-length: 1
                                  mapping:
                                    "query":
                                        type: str
                                        required: true

                            - type: seq
                              sequence:
                                - *DEFAULT_ITEM

                    "mods": &ATOM_MODS
                        type: seq
                        sequence:
                          - type: choice
                            choice:
                                - type: map
                                  object: semantix.caos.backends.yaml.AtomModMaxLength
                                  max-length: 1
                                  min-length: 1
                                  mapping:
                                    "max-length":
                                        type: int
                                - type: map
                                  object: semantix.caos.backends.yaml.AtomModMaxValue
                                  max-length: 1
                                  min-length: 1
                                  mapping:
                                    "max-value":
                                        type: any
                                - type: map
                                  object: semantix.caos.backends.yaml.AtomModMaxExValue
                                  max-length: 1
                                  min-length: 1
                                  mapping:
                                    "max-value-ex":
                                        type: any
                                - type: map
                                  object: semantix.caos.backends.yaml.AtomModMinLength
                                  max-length: 1
                                  min-length: 1
                                  mapping:
                                    "min-length":
                                        type: int
                                - type: map
                                  object: semantix.caos.backends.yaml.AtomModMinValue
                                  max-length: 1
                                  min-length: 1
                                  mapping:
                                    "min-value":
                                        type: any
                                - type: map
                                  object: semantix.caos.backends.yaml.AtomModMinExValue
                                  max-length: 1
                                  min-length: 1
                                  mapping:
                                    "min-value-ex":
                                        type: any
                                - type: map
                                  object: semantix.caos.backends.yaml.AtomModRegExp
                                  max-length: 1
                                  min-length: 1
                                  mapping:
                                    "regexp":
                                        type: str
                                - type: map
                                  object: semantix.caos.backends.yaml.AtomModExpr
                                  max-length: 1
                                  min-length: 1
                                  mapping:
                                    "expr":
                                        type: str
                                - type: map
                                  object: semantix.caos.backends.yaml.AtomModPrecision
                                  max-length: 1
                                  min-length: 1
                                  mapping:
                                    "precision":
                                        type: choice
                                        choice:
                                            - type: seq
                                              max-length: 2
                                              min-length: 2
                                              sequence:
                                                - type: int
                                            - type: int
                                - type: map
                                  object: semantix.caos.backends.yaml.AtomModRounding
                                  max-length: 1
                                  min-length: 1
                                  mapping:
                                    "rounding":
                                        type: str
                                        enum: [ceiling, down, floor, half-down,
                                               half-even, half-up, up, 05up]

    "links":
        type: map
        default: {}
        mapping:
            =: # name of a link
                type: map
                object: semantix.caos.backends.yaml.LinkDef
                required: yes
                mapping:
                    "title": *TEXT_WITH_GRAM_CATEGORIES

                    "description":
                        type: str

                    "extends":
                        type: choice
                        default:
                        choice:
                            - type: str
                            - type: seq
                              sequence:
                                - type: str

                    "abstract":
                        type: bool

                    "readonly":
                        type: bool

                    "required":
                        type: bool

                    "default":
                        *DEFAULT

                    "mapping": &LINK_MAPPING
                        type: str
                        object: semantix.caos.backends.yaml.LinkMapping
                        enum: ["1*", "11", "**", "*1"]
                        default: null

                    "properties":
                        type: map
                        default: {}
                        mapping:
                            =:
                                type: choice
                                object: semantix.caos.backends.yaml.LinkProperty
                                choice:
                                    - type: str
                                    - type: map
                                      mapping:
                                        =:
                                            type: map
                                            max-length: 1
                                            min-length: 1
                                            mapping:
                                                "title":
                                                    *TEXT_WITH_GRAM_CATEGORIES
                                                "description":
                                                    type: str
                                                "required":
                                                    type: bool
                                                    default: False
                                                "mods": *ATOM_MODS


    "concepts":
        type: map
        default: {}
        mapping:
            =:
                type: map
                object: semantix.caos.backends.yaml.Concept
                mapping:
                    "title":
                        *TEXT_WITH_GRAM_CATEGORIES

                    "abstract":
                        type: bool
                        default: null

                    "description":
                        type: str

                    "extends":
                        type: choice
                        default:
                        choice:
                            - type: str
                            - type: seq
                              sequence:
                                - type: str

                    "links":
                        type: map
                        default: {}
                        mapping:
                            =:
                                type: map
                                object: semantix.caos.backends.yaml.LinkList
                                type: choice
                                required: yes
                                choice:
                                  - type: str
                                  - type: seq
                                    sequence:
                                        - type: str
                                  - type: map
                                    max-length: 1
                                    min-length: 1
                                    mapping:
                                        =:
                                            type: map
                                            mapping:
                                              "title":
                                                  *TEXT_WITH_GRAM_CATEGORIES
                                              "description":
                                                  type: str
                                              "required":
                                                  type: bool
                                                  default: null
                                              "readonly":
                                                  type: bool
                                                  default: null
                                              "mapping":
                                                  *LINK_MAPPING
                                              "mods":
                                                  *ATOM_MODS
                                              "comparison":
                                                  type: str
                                                  enum: [cidirect, fuzzy]
                                              "default":
                                                  *DEFAULT
                                              "constraints":
                                                  type: seq
                                                  sequence:
                                                    - type: choice
                                                      choice:
                                                        - type: map
                                                          max-length: 1
                                                          min-length: 1
                                                          object: semantix.caos.backends.yaml.LinkConstraintUnique
                                                          mapping:
                                                            "unique":
                                                               type: str
                                                               required: True
                                              "properties":
                                                  type: map
                                                  mapping:
                                                    =:
                                                        type: any
                                              "search":
                                                  type: choice
                                                  object: semantix.caos.backends.yaml.LinkSearchConfiguration
                                                  choice:
                                                    - type: map
                                                      mapping:
                                                         "weight":
                                                            type: str
                                                            object: semantix.caos.backends.yaml.LinkSearchWeight
                                                            enum: ['A', 'B', 'C', 'D']
                                                            required: True
                                                    - type: bool

                    "heuristics":
                        type: map
                        mapping:
                            "comparison":
                                type: seq
                                sequence:
                                    -
                                        type: map
                                        mapping:
                                            "link":
                                                type: str

                                            "attribute":
                                                type: str

                                            "weight":
                                                type: float
                                                range: {min: 0.0, max: 1.0}
                                                required: yes
